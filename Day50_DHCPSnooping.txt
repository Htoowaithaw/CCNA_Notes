# **Day 50 | DHCP Snooping | CCNA 200-301 Complete Course**

## ğŸ›¡ï¸ **DHCP Snooping â€“ L2 Security Feature (Exam Topic 5.7)**

---

### ğŸ” **What is DHCP Snooping?**

| Concept | ğŸ§‘â€ğŸ« Tech Guy-style | âœˆï¸ Easy Way |
| --- | --- | --- |
| DHCP Snooping | L2 switch feature that filters DHCP messages on **untrusted ports** | Like a checkpoint gate that inspects passengers from outside before letting them through |
| Trusted Port | Messages are **not inspected** | Known staff entrance â€” no ID checks needed |
| Untrusted Port | Messages are **inspected and filtered** | Guest or unknown entrance â€” all bags & IDs are checked |
| Default Status | **All ports are untrusted by default** | Every gate starts off as suspicious until you explicitly allow it |

---

### ğŸ”’ **What Attacks Can DHCP Snooping Prevent?**

| Attack | ğŸ§‘â€ğŸ« Tech Guy-style | âœˆï¸ Easy Way |
| --- | --- | --- |
| DHCP Starvation | Attacker floods DISCOVERs with fake MACs, exhausting IP pool | Someone keeps fake booking all available plane seats, so others canâ€™t board |
| DHCP Spoofing/Poisoning | Rogue DHCP server sends fake gateway info â†’ MITM | Fake staff hands out wrong boarding passes with attackerâ€™s gate printed |

---

### ğŸ” **DHCP Message Types (Important for Filtering)**

| Type | Sent By | Purpose | Trusted Port | Untrusted Port |
| --- | --- | --- | --- | --- |
| DISCOVER | Client | Looking for a DHCP server | âœ… Forward | âœ… Inspect/Forward or Drop |
| REQUEST | Client | Asks for offered IP | âœ… Forward | âœ… Inspect/Forward or Drop |
| RELEASE | Client | Tells server it no longer needs IP | âœ… Forward | âœ… Verify against binding table |
| DECLINE | Client | Says offered IP is already in use | âœ… Forward | âœ… Verify against binding table |
| OFFER | Server | Offers an IP to the client | âœ… Forward | âŒ Always Drop |
| ACK | Server | Confirms the IP assignment | âœ… Forward | âŒ Always Drop |
| NAK | Server | Rejects clientâ€™s request | âœ… Forward | âŒ Always Drop |

---

### ğŸ§  **DHCP Snooping Binding Table**

| Field Logged | Description |
| --- | --- |
| MAC Address | Clientâ€™s hardware address |
| IP Address | Leased IP address |
| Lease Time | Lease duration |
| VLAN | VLAN ID the client belongs to |
| Interface | Port the client is connected to |

Use command:

```bash
bash
CopyEdit
show ip dhcp snooping binding

```

---

### âš™ï¸ **Basic DHCP Snooping Configuration**

```bash
bash
CopyEdit
# Global config
ip dhcp snooping

# Enable per VLAN
ip dhcp snooping vlan 1

# Disable Option 82 (Optional but often needed)
no ip dhcp snooping information option

# Mark trusted interfaces (uplinks to DHCP server or other switches)
interface g0/0
ip dhcp snooping trust

```

---

### â›” **Filtering Behavior on Untrusted Ports**

| DHCP Message Type | Check Applied | Action |
| --- | --- | --- |
| OFFER, ACK, NAK | Always dropped | âŒ Discard |
| DISCOVER, REQUEST | Compare **Ethernet src MAC** with **CHADDR** in message | âœ… Forward if match, âŒ Drop if mismatch |
| RELEASE, DECLINE | Check against **binding table** | âœ… Forward if valid, âŒ Drop if mismatch |

---

### ğŸ“‰ **Rate Limiting**

```bash
bash
CopyEdit
# Set DHCP rate limit (e.g., 5 per second)
interface g0/1
ip dhcp snooping limit rate 5

```

| Action | Outcome |
| --- | --- |
| Exceed rate limit | Interface enters `err-disabled` |
| Manual Recovery | `shutdown` + `no shutdown` |
| Auto Recovery (optional) | Enable with: |

```bash
bash
CopyEdit
errdisable recovery cause dhcp-rate-limit
errdisable recovery interval 30

```

---

### ğŸ’¡ **DHCP Option 82 (Relay Agent Info)**

- Switch **adds Option 82** even if it's not a DHCP relay.
- Upstream switches **drop messages with Option 82** on untrusted ports.
- Some DHCP servers **reject Option 82** if not from real relay agents.

**Fix:**

```bash
bash
CopyEdit
no ip dhcp snooping information option

```

ğŸ“Œ Use this command on all switches if not using relay agents to avoid message drops.

---

### âœ… **Quiz Review (Correct Answers)**

**Q1:** Which messages are always dropped on untrusted ports?

âœ… ACK, OFFER, NAK

**Q2:** What is NOT stored in the snooping table?

âœ… Default Gateway

**Q3:** What are DHCP snooping functions?

âœ… Rate limit DHCP messages

âœ… Filter messages on untrusted ports

**Q4:** When inspecting DISCOVER, what does it check?

âœ… Source MAC and CHADDR field

**Q5:** What happens if rate is exceeded?

âœ… Interface is disabled